/*! 
 * angular-advanced-searchbox v3.1.0
 * https://github.com/dnauck/angular-advanced-searchbox
 * Copyright (c) 2017 Nauck IT KG http://www.nauck-it.de/
 * License: MIT
 */
!function(){"use strict";angular.module("angular-advanced-searchbox",[]).directive("nitAdvancedSearchbox",function(){return{restrict:"E",scope:{model:"=ngModel",parameters:"=",parametersLabel:"@",parametersDisplayLimit:"=?",placeholder:"@",searchThrottleTime:"=?"},replace:!0,templateUrl:function(a,b){return b.templateUrl||"angular-advanced-searchbox.html"},controller:["$scope","$attrs","$element","$timeout","$filter","setFocusFor",function(a,b,c,d,e,f){function g(){console.log("Running restoreModel");var b,c=a.model;for(b=0;b<c.length;b++)console.log("restoreModel FOR loop: ",c[b])}function h(b,c,f,g){console.log("Running updateModel command, key, index, value: ",b,c,f,g),j&&d.cancel(j),k=e("filter")(k,function(a){return a.key!==c&&a.index!==f}),k.push({command:b,key:c,index:f,value:g}),a.model=a.searchParams}function i(a){if(console.log("Running getCurrentCaretPosition"),!a)return 0;try{if("number"==typeof a.selectionStart)return"backward"===a.selectionDirection?a.selectionStart:a.selectionEnd;if(document.selection){a.focus();var b=document.selection.createRange(),c=document.selection.createRange().text.length;return b.moveStart("character",-a.value.length),b.text.length-c}}catch(d){}return 0}a.status={isopen:!1},a.model=a.model||[],a.parameters=a.parameters||[],a.filteredArr=a.parameters,a.parametersLabel=a.parametersLabel||"Parameter Suggestions",a.parametersDisplayLimit=a.parametersDisplayLimit||8,a.placeholder=a.placeholder||"Search ...",a.searchThrottleTime=a.searchThrottleTime||0,a.searchParams=[],a.searchQuery="",a.setFocusFor=f,a.isSpacebarKey=!1;var j,k=[];a.showMenu=function(b){b&&b.stopPropagation(),a.status.isopen=!0},a.hideMenu=function(b){b&&b.stopPropagation(),a.status.isopen=!1},a.$watch("model",function(b,c){if(!angular.equals(b,c)){var d,f=a.model;for(d=0;d<f.length;d++)console.log("$scope.$watch: ",f[d]);angular.forEach(a.model,function(b,c){if(console.log("value: ",b),console.log("key: ",c),"query"===c&&a.searchQuery!==b)a.searchQuery=b;else{var d=e("filter")(a.parameters,function(a){return a.key===c})[0],f=e("filter")(a.searchParams,function(a){return a.key===c});if(console.log("paramTemplate: ",d),console.log("searchParams: ",f),void 0!==d)if(d.allowMultiple){if(angular.isArray(b)||(b=[b]),b.forEach(function(b,c){if(f.some(function(a){return a.index===c})){var e=f.filter(function(a){return a.index===c});e[0].value!==b&&(e[0].value=b)}else a.addSearchParam(d,b,!1)}),b.length<f.length)for(var g=b.length;g<f.length;g++)a.removeSearchParam(a.searchParams.indexOf(f[g]))}else 0===f.length?a.addSearchParam(d,b,!1):f[0].value!==b&&(f[0].value=b)}})}},!0),a.searchParamValueChanged=function(a){h("change",a.key,a.index,a.value)},a.searchQueryChanged=function(a){h("change","query",0,a)},a.enterEditMode=function(b,c){if(console.log("Running enterEditMode, e, index: ",b,c),void 0!==b&&b.stopPropagation(),void 0!==c){var d=a.searchParams[c];d.editMode=!0,console.log("enterEditMode searchParam: ",d),f("searchParam:"+d.key),a.$emit("advanced-searchbox:enteredEditMode",d)}},a.maybeLeaveEditMode=function(b,c){return a.isSpacebarKey===!0?void b.preventDefault():null!==b.relatedTarget&&-1!==b.relatedTarget.parentElement.id.indexOf("typeahead")?!1:a.leaveEditMode(b,c)},a.leaveEditMode=function(b,c){if(a.status.isopen=!0,void 0!==c){var d=a.searchParams[c];d.editMode=!1,a.$emit("advanced-searchbox:leavedEditMode",d),d.value||a.removeSearchParam(c)}},a.searchQueryTypeaheadOnSelect=function(b,c,d){console.log("Running $scope.searchQueryTypeaheadOnSelect DELETE: ",b,c,d),a.addSearchParam(b),a.searchQuery="",h("delete","query",0)},a.searchParamTypeaheadOnSelect=function(b,c){console.log("searchParamTypeaheadOnSelect - suggestedValue, searchParam: ",b,c),c.value=b,a.searchParamValueChanged(c)},a.isUnusedParameter=function(a,b){return!0},a.canAddParameter=function(){for(var b=a.parameters.length,c=0;c<a.parameters.length;c++)if(!a.parameters[c].allowMultiple)for(var d=0;d<a.searchParams.length;d++)if(a.parameters[c].key===a.searchParams[d].key){b-=1;break}return b>0},a.addSearchParam=function(b,c,e){console.log("Running addSearchParam - searchParam, value, enterEditModel: ",b,c,e),void 0===e&&(e=!0);var f=a.model.length,g=a.searchParams.push({key:b.key,name:b.name,type:b.type||"text",placeholder:b.placeholder,allowMultiple:b.allowMultiple||!1,suggestedValues:b.suggestedValues||[],suggestedToString:b.suggestedToString||"",restrictToSuggestedValues:b.restrictToSuggestedValues||!1,index:f,value:c||""})-1;h("add",b.key,f,c),e===!0&&d(function(){a.enterEditMode(void 0,g)},250),a.$emit("advanced-searchbox:addedSearchParam",b)},a.removeSearchParam=function(b){if(console.log("Running removeSearchParam: ",b),void 0!==b){var c=a.searchParams[b];if(a.searchParams.splice(b,1),c.allowMultiple)for(var d=e("filter")(a.searchParams,function(a){return a.key===c.key}),f=0;f<d.length;f++)d[f].index=f;h("delete",c.key,c.index),a.$emit("advanced-searchbox:removedSearchParam",c)}},a.removeAll=function(){a.searchParams.length=0,a.searchQuery="",a.model=[],a.$emit("advanced-searchbox:removedAllSearchParam")},a.editPrevious=function(b){void 0!==b&&a.leaveEditMode(void 0,b),b>0?a.enterEditMode(void 0,b-1):a.searchParams.length>0?a.enterEditMode(void 0,a.searchParams.length-1):0===a.searchParams.length&&f("searchbox")},a.editNext=function(b){void 0!==b&&(a.leaveEditMode(void 0,b),b<a.searchParams.length-1?a.enterEditMode(void 0,b+1):f("searchbox"))},a.keydown=function(b,c){var d=[8,9,13,32,37,39];if(-1!==d.indexOf(b.which)){if(32==b.which)return void(a.isSpacebarKey=!0);var e=i(b.target);8==b.which?0===e&&(b.preventDefault(),a.editPrevious(c)):9==b.which?b.shiftKey?(b.preventDefault(),a.editPrevious(c)):(b.preventDefault(),a.editNext(c)):13==b.which?a.editNext(c):37==b.which?0===e&&a.editPrevious(c):39==b.which&&e===b.target.value.length&&a.editNext(c)}},a.keyup=function(b,c){var e=a.searchQuery,f=b.which||b.keyCode||b.charCode;return 8!==f&&9!==f&&13!==f&&27!==f&&46!==f&&(e=e.toLowerCase())," "==e?(a.showMenu(b),void d(function(){a.searchQuery=""})):""===e?void(a.filteredArr=angular.copy(a.parameters)):void((8!==f||46!==f)&&a.filterFacets(b,e))},a.isMatchLabel=function(a){return Array.isArray(a)},a.filterFacets=function(b,c){var e,f,g,h=[];for(a.filteredArr=angular.copy(a.parameters),e=0;e<a.filteredArr.length;e++){var i=a.filteredArr[e];if(f=i.name.toLowerCase().indexOf(c),f>-1){g=[i.name.substring(0,f),i.name.substring(f,f+c.length),i.name.substring(f+c.length)];var j=i;j.label=g,h.push(j),console.log("filtered: ",h)}}h.length>0?(a.showMenu(b),d(function(){a.filteredArr=h},.1)):a.hideMenu(b)},void 0===a.model?a.model=[]:g()}]}}).directive("setFocusOn",[function(){return{restrict:"A",link:function(a,b,c){return a.$on("advanced-searchbox:setFocusOn",function(d,e){return console.log("setFocusOn id: ",e),a.isSpacebarKey===!0?(a.isSpacebarKey=!1,void d.preventDefault()):e===c.setFocusOn?b[0].focus():void 0})}}}]).factory("setFocusFor",["$rootScope","$timeout",function(a,b){return function(c){return b(function(){return a.$broadcast("advanced-searchbox:setFocusOn",c)})}}]).directive("nitAutoSizeInput",["$timeout",function(a){return{restrict:"A",scope:{model:"=ngModel"},link:function(b,c,d){function e(){a(function(){-1!==f.indexOf(c[0].type||"text")&&(h.text(c.val()||c.attr("placeholder")),c.css("width",h.outerWidth()+10))})}var f=["text","search","tel","url","email","password","number"],g=angular.element('<div style="position: fixed; top: -9999px; left: 0px;"></div>'),h=angular.element('<span style="white-space:pre;"></span>'),i="none"===c.css("maxWidth")?c.parent().innerWidth():c.css("maxWidth");c.css("maxWidth",i),angular.forEach(["fontSize","fontFamily","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent","boxSizing","borderLeftWidth","borderRightWidth","borderLeftStyle","borderRightStyle","paddingLeft","paddingRight","marginLeft","marginRight"],function(a){h.css(a,c.css(a))}),angular.element("body").append(g.append(h)),e(),b.model?b.$watch("model",function(){e()}):c.on("keypress keyup keydown focus input propertychange change",function(){e()})}}}]).filter("toString",function(){return function(a,b){b=b||String;var c=b(a);return c}})}(),angular.module("angular-advanced-searchbox").run(["$templateCache",function(a){"use strict";a.put("angular-advanced-searchbox.html",'<div class=advancedSearchBox ng-class={active:focus} ng-init="focus = false" ng-click="!focus ? setFocusFor(\'searchbox\') : null"><span ng-show="searchParams.length < 1 && searchQuery.length === 0" class="search-icon glyphicon glyphicon-search"></span> <a ng-href="" ng-show="searchParams.length > 0 || searchQuery.length > 0" ng-click=removeAll() role=button><span class="remove-all-icon glyphicon glyphicon-trash"></span></a><div class="searchBox clearfix"><div class=search-parameter ng-repeat="searchParam in searchParams"><a ng-href="" ng-click=removeSearchParam($index) role=button>&times;</a><div class=key ng-show="searchParam.type !== \'operator\'" data-key={{searchParam.key}} data-type={{searchParam.type}} ng-click="enterEditMode($event, $index)">{{searchParam.name}}:</div><div class=value><span ng-show=!searchParam.editMode ng-click="enterEditMode($event, $index)">{{searchParam.value | toString:searchParam.suggestedToString}}</span> <input name=value type={{searchParam.type}} nit-auto-size-input set-focus-on="{{\'searchParam:\' + searchParam.key}}" ng-keydown="keydown($event, $index)" ng-blur="maybeLeaveEditMode($event, $index)" ng-show=searchParam.editMode ng-change="searchParam.restrictToSuggestedValues !== true ? searchParamValueChanged(searchParam) : null" ng-model=searchParam.value uib-typeahead="suggestedValue as suggestedValue.name for suggestedValue in searchParam.suggestedValues | filter:$viewValue" typeahead-min-length=0 typeahead-on-select="searchParamTypeaheadOnSelect($item, searchParam)" typeahead-editable="searchParam.restrictToSuggestedValues !== true" typeahead-select-on-exact=true typeahead-select-on-blur="searchParam.restrictToSuggestedValues !== true ? false : true" placeholder={{searchParam.placeholder}} ng-click="enterEditMode($event, $index)" ng-trim="false"></div></div><div class=search-entry uib-dropdown is-open=status.isopen><input autocomplete=off uib-dropdown-toggle name=searchbox class=search-parameter-input nit-auto-size-input set-focus-on=searchbox ng-keydown=keydown($event) ng-keyup=keyup($event) placeholder={{placeholder}} ng-focus="focus = true" ng-blur="focus = false" xxx-uib-typeahead="parameter as parameter.name for parameter in parameters | filter:isUnusedParameter | filter:{name:$viewValue} | limitTo:parametersDisplayLimit" xxx-typeahead-on-select="searchQueryTypeaheadOnSelect($item, $model, $label)" ng-change=searchQueryChanged(searchQuery) ng-model="searchQuery"><ul class=dropdown-menu uib-dropdown-menu role=menu><li><a href="" ng-click=""><i class="glyphicon glyphicon-search"></i> Search</a></li><li class=divider></li><li ng-repeat="parameter in filteredArr" xxx-ng-show=!facetSelected><a ng-click=searchQueryTypeaheadOnSelect(parameter) ng-show=!isMatchLabel(parameter.label)>{{ parameter.name }}</a> <a ng-click=searchQueryTypeaheadOnSelect(parameter) ng-show=isMatchLabel(parameter.label)>{{ parameter.label[0] }}<span class=match>{{ parameter.label[1] }}</span>{{ parameter.label[2] }}</a></li><li ng-repeat="parameter in filteredArr" xxx-ng-show=facetSelected><a ng-click="optionClicked($index, $event, parameter)" ng-show=!isMatchLabel(parameter)>{{ parameter.name }}</a> <a ng-click="optionClicked($index, $event, option.key)" ng-show=isMatchLabel(option.label)>{{ parameter.label[0] }}<span class=match>{{ parameter.label[1] }}</span>{{ parameter.label[2] }}</a></li></ul></div></div><div class="search-parameter-suggestions clearfix" xxx-ng-show="parameters && focus && canAddParameter()"><span class=title>{{parametersLabel}}:</span> <span class=search-parameter ng-repeat="param in parameters | filter:isUnusedParameter | limitTo:parametersDisplayLimit" data-key={{param.key}} ng-mousedown=addSearchParam(param)>{{param.name}} <i ng-class="{\'glyphicon glyphicon-plus\': param.allowMultiple}"></i></span></div><strong>searchQuery:</strong> {{searchQuery | json }}<br><strong>searchParams</strong><br>LENGTH: {{searchParams.length}}<br>CONTENT {{searchParams | json}}</div>')}]);